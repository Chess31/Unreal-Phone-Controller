<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Phone Motion Controller</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #111; color: #eee; }
    h1 { font-size: 1.5rem; }
    button { padding: 0.5rem 1rem; font-size: 1rem; margin-bottom: 1rem; }
    .value { margin: 0.2rem 0; }
  </style>
</head>
<body>
  <h1>Phone Motion Controller</h1>
  <button onclick="requestSensorPermissions()">Enable Sensors</button>
  <div id="status">üîå Connecting to WebSocket...</div>

  <div class="value">Alpha: <span id="alpha">-</span></div>
  <div class="value">Beta: <span id="beta">-</span></div>
  <div class="value">Gamma: <span id="gamma">-</span></div>

  <script>
    const socket = new WebSocket("ws://YOUR_PC_LOCAL_IP:8000");

    socket.onopen = () => document.getElementById("status").innerText = "‚úÖ WebSocket connected";
    socket.onerror = (e) => {
      console.error("‚ùå WebSocket error", e);
      document.getElementById("status").innerText = "‚ùå WebSocket error";
    };

    function update(id, val) {
      if (val != null) document.getElementById(id).innerText = val.toFixed(2);
    }

    function handleOrientation(event) {
      update("alpha", event.alpha);
      update("beta", event.beta);
      update("gamma", event.gamma);

      const data = {
        type: "orientation",
        alpha: event.alpha,
        beta: event.beta,
        gamma: event.gamma
      };

      if (socket.readyState === WebSocket.OPEN) {
        socket.send(JSON.stringify(data));
      }
    }

    async function requestSensorPermissions() {
      try {
        if (typeof DeviceMotionEvent?.requestPermission === "function") {
          const motion = await DeviceMotionEvent.requestPermission();
          const orientation = await DeviceOrientationEvent.requestPermission();
          if (motion === "granted" || orientation === "granted") {
            enableSensors();
          } else {
            alert("‚ùå Permission denied.");
          }
        } else {
          enableSensors(); // Non-iOS
        }
      } catch (err) {
        alert("‚ùå Error requesting permissions.");
        console.error(err);
      }
    }

    function enableSensors() {
      window.addEventListener("deviceorientation", handleOrientation);
    }
  </script>
</body>
</html>
